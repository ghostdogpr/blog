<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Astro v5.13.7"><!-- Favicons --><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="apple-mobile-web-app-title" content="Pierre Ricadat's Tech Blog"><!-- Canonical URL --><link rel="canonical" href="https://blog.pierre-ricadat.com/graphql-in-scala-advanced-schema-generation/"><!-- Primary Meta Tags --><title>GraphQL in Scala: Advanced Schema Generation</title><meta name="title" content="GraphQL in Scala: Advanced Schema Generation"><meta name="description" content="In my Beginner's Guide to GraphQL in Scala, I explained how Caliban can automatically transform Scala types into GraphQL types through a process called schem...
"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://blog.pierre-ricadat.com/graphql-in-scala-advanced-schema-generation/"><meta property="og:title" content="GraphQL in Scala: Advanced Schema Generation"><meta property="og:description" content="In my Beginner's Guide to GraphQL in Scala, I explained how Caliban can automatically transform Scala types into GraphQL types through a process called schem...
"><meta property="og:image" content="https://blog.pierre-ricadat.com/saral-og.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://blog.pierre-ricadat.com/graphql-in-scala-advanced-schema-generation/"><meta property="twitter:title" content="GraphQL in Scala: Advanced Schema Generation"><meta property="twitter:description" content="In my Beginner's Guide to GraphQL in Scala, I explained how Caliban can automatically transform Scala types into GraphQL types through a process called schem...
"><meta property="twitter:image" content="https://blog.pierre-ricadat.com/saral-og.jpg"><!-- RSS Auto-discovery --><link rel="alternate" type="application/rss+xml" title="Pierre Ricadat's Tech Blog RSS Feed" href="https://blog.pierre-ricadat.com/rss.xml"><link rel="stylesheet" href="/_astro/_slug_.DSRIcTml.css"><script>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.11.2 - MIT QwikDev */
const t={preserveBehavior:!1},e=e=>{if("string"==typeof e)return[e,t];const[n,r=t]=e;return[n,{...t,...r}]},n=Object.freeze((t=>{const e=new Set;let n=[];do{Object.getOwnPropertyNames(n).forEach((t=>{"function"==typeof n[t]&&e.add(t)}))}while((n=Object.getPrototypeOf(n))!==Object.prototype);return Array.from(e)})());!function(t,r,o,i,a,s,c,l,d,p,u=t,f){function h(){f||(f=1,"/"==(c=(s.lib||"/~partytown/")+(s.debug?"debug/":""))[0]&&(d=r.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(l=setTimeout(v,(null==s?void 0:s.fallbackTimeout)||1e4),r.addEventListener("pt0",w),a?y(1):o.serviceWorker?o.serviceWorker.register(c+(s.swPath||"partytown-sw.js"),{scope:c}).then((function(t){t.active?y():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&y()}))}),console.error):v())))}function y(e){p=r.createElement(e?"script":"iframe"),t._pttab=Date.now(),e||(p.style.display="block",p.style.width="0",p.style.height="0",p.style.border="0",p.style.visibility="hidden",p.setAttribute("aria-hidden",!0)),p.src=c+"partytown-"+(e?"atomics.js?v=0.11.2":"sandbox-sw.html?"+t._pttab),r.querySelector(s.sandboxParent||"body").appendChild(p)}function v(n,o){for(w(),i==t&&(s.forward||[]).map((function(n){const[r]=e(n);delete t[r.split(".")[0]]})),n=0;n<d.length;n++)(o=r.createElement("script")).innerHTML=d[n].innerHTML,o.nonce=s.nonce,r.head.appendChild(o);p&&p.parentNode.removeChild(p)}function w(){clearTimeout(l)}s=t.partytown||{},i==t&&(s.forward||[]).map((function(r){const[o,{preserveBehavior:i}]=e(r);u=t,o.split(".").map((function(e,r,o){var a;u=u[o[r]]=r+1<o.length?u[o[r]]||(a=o[r+1],n.includes(a)?[]:{}):(()=>{let e=null;if(i){const{methodOrProperty:n,thisObject:r}=((t,e)=>{let n=t;for(let t=0;t<e.length-1;t+=1)n=n[e[t]];return{thisObject:n,methodOrProperty:e.length>0?n[e[e.length-1]]:void 0}})(t,o);"function"==typeof n&&(e=(...t)=>n.apply(r,...t))}return function(){let n;return e&&(n=e(arguments)),(t._ptf=t._ptf||[]).push(o,arguments),n}})()}))})),"complete"==r.readyState?h():(t.addEventListener("DOMContentLoaded",h),t.addEventListener("load",h))}(window,document,navigator,top,window.crossOriginIsolated);;(e=>{e.addEventListener("astro:before-swap",e=>{let r=document.body.querySelector("iframe[src*='/~partytown/']");if(r)e.newDocument.body.append(r)})})(document);</script></head> <body class="text-foreground bg-background font-light dark:text-foreground-dark dark:bg-background-dark transition-colors"> <header class="fixed top-0 w-full z-40 bg-background dark:bg-background-dark"> <nav class=""> <div class="app-container flex justify-between items-center py-5"> <a href="/" aria-label="Home"> <svg width="36" height="36" viewBox="0 0 36 36" fill="none">
  <rect width="36" height="36" rx="8" fill="currentColor" opacity="0.1" />
  <text x="18" y="25" font-family="system-ui, -apple-system, sans-serif" font-size="18" font-weight="700" fill="currentColor" text-anchor="middle">PR</text>
</svg> </a> <div class="gap-8 hidden md:flex items-center"> <a href="/" class="text-lg" target="_self" data-astro-cid-rieiwi5x> Blog </a> <a href="https://github.com/sponsors/ghostdogpr" class="text-lg" target="_blank" data-astro-cid-rieiwi5x> Sponsor </a>  <div class="border-[1px] border-foreground dark:border-foreground-dark rounded-full flex justify-center items-center text-foreground dark:text-foreground-dark [&#38;>*:hover]:brightness-75 md:opacity-80 [&#38;>*]:cursor-pointer" data-astro-cid-lgn464si> <button data-theme="theme-auto" aria-label="Auto Theme" title="Set theme to follow system preference" class="theme-button theme-auto" data-astro-cid-lgn464si> <svg width="1em" height="1em" aria-hidden="true" data-astro-cid-lgn464si="true" class="duration-0 text-2xl md:text-xl" data-icon="mdi:brightness-auto">   <symbol id="ai:mdi:brightness-auto" viewBox="0 0 24 24"><path fill="currentColor" d="m14.3 16l-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69L8.69 4H4v4.69L.69 12L4 15.31V20h4.69L12 23.31L15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></symbol><use href="#ai:mdi:brightness-auto"></use>  </svg> </button> <button data-theme="theme-light" aria-label="Light Theme" title="Set theme to light" class="theme-button theme-light" data-astro-cid-lgn464si> <svg width="1em" height="1em" aria-hidden="true" data-astro-cid-lgn464si="true" class="duration-0 text-2xl md:text-xl" data-icon="mdi:white-balance-sunny">   <symbol id="ai:mdi:white-balance-sunny" viewBox="0 0 24 24"><path fill="currentColor" d="m3.55 19.09l1.41 1.41l1.8-1.79l-1.42-1.42M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6s6-2.69 6-6c0-3.32-2.69-6-6-6m8 7h3v-2h-3m-2.76 7.71l1.8 1.79l1.41-1.41l-1.79-1.8M20.45 5l-1.41-1.4l-1.8 1.79l1.42 1.42M13 1h-2v3h2M6.76 5.39L4.96 3.6L3.55 5l1.79 1.81zM1 13h3v-2H1m12 9h-2v3h2"/></symbol><use href="#ai:mdi:white-balance-sunny"></use>  </svg> </button> <button data-theme="theme-dark" aria-label="Dark Theme" title="Set theme to dark" class="theme-button theme-dark" data-astro-cid-lgn464si> <svg width="1em" height="1em" aria-hidden="true" data-astro-cid-lgn464si="true" class="duration-0 text-2xl md:text-xl" data-icon="mdi:moon-and-stars">   <symbol id="ai:mdi:moon-and-stars" viewBox="0 0 24 24"><path fill="currentColor" d="m17.75 4.09l-2.53 1.94l.91 3.06l-2.63-1.81l-2.63 1.81l.91-3.06l-2.53-1.94L12.44 4l1.06-3l1.06 3zm3.5 6.91l-1.64 1.25l.59 1.98l-1.7-1.17l-1.7 1.17l.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85c-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14c.4-.4.82-.76 1.27-1.08c.75-.53 1.93.36 1.85 1.19c-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82c-2.81 3.14-2.7 7.96.31 10.98c3.02 3.01 7.84 3.12 10.98.31"/></symbol><use href="#ai:mdi:moon-and-stars"></use>  </svg> </button> </div>  </div> <button class="md:hidden cursor-pointer" id="nav-open-btn" aria-label="Open navigation menu" title="Open navigation menu"> <svg width="32" height="32" aria-hidden="true" data-icon="mdi:menu">   <symbol id="ai:mdi:menu" viewBox="0 0 24 24"><path fill="currentColor" d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></symbol><use href="#ai:mdi:menu"></use>  </svg> </button> <!-- Mobile nav --> <div class="translate-x-full md:hidden fixed top-0 right-0 bg-background dark:bg-background-dark h-screen w-5/6 px-8 py-6 transition-transform z-40 border-l-[1px] border-background" id="mobile-menu"> <button id="nav-close-btn" class="ml-auto block cursor-pointer" aria-label="Close navigation menu" title="Close navigation menu"> <svg width="32" height="32" aria-hidden="true" data-icon="mdi:close">   <symbol id="ai:mdi:close" viewBox="0 0 24 24"><path fill="currentColor" d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12z"/></symbol><use href="#ai:mdi:close"></use>  </svg> </button> <div class="flex flex-col h-full items-start gap-8 pt-16"> <a href="/" class="text-4xl font-light" target="_self" data-astro-cid-rieiwi5x> Blog </a> <a href="https://github.com/sponsors/ghostdogpr" class="text-4xl font-light" target="_blank" data-astro-cid-rieiwi5x> Sponsor </a>  <div class="mt-4 border-[1px] border-foreground dark:border-foreground-dark rounded-full flex justify-center items-center text-foreground dark:text-foreground-dark [&#38;>*:hover]:brightness-75 md:opacity-80 [&#38;>*]:cursor-pointer" data-astro-cid-lgn464si> <button data-theme="theme-auto" aria-label="Auto Theme" title="Set theme to follow system preference" class="theme-button theme-auto" data-astro-cid-lgn464si> <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" data-astro-cid-lgn464si="true" class="duration-0 text-2xl md:text-xl" data-icon="mdi:brightness-auto">   <use href="#ai:mdi:brightness-auto"></use>  </svg> </button> <button data-theme="theme-light" aria-label="Light Theme" title="Set theme to light" class="theme-button theme-light" data-astro-cid-lgn464si> <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" data-astro-cid-lgn464si="true" class="duration-0 text-2xl md:text-xl" data-icon="mdi:white-balance-sunny">   <use href="#ai:mdi:white-balance-sunny"></use>  </svg> </button> <button data-theme="theme-dark" aria-label="Dark Theme" title="Set theme to dark" class="theme-button theme-dark" data-astro-cid-lgn464si> <svg width="1em" height="1em" viewBox="0 0 24 24" aria-hidden="true" data-astro-cid-lgn464si="true" class="duration-0 text-2xl md:text-xl" data-icon="mdi:moon-and-stars">   <use href="#ai:mdi:moon-and-stars"></use>  </svg> </button> </div>  </div> </div> </div> </nav> <script type="module">function e(){document.querySelector("#mobile-menu")?.classList.toggle("mobile-nav-open")}document.querySelector("#nav-open-btn")?.addEventListener("click",e);document.querySelector("#nav-close-btn")?.addEventListener("click",e);</script> </header> <script>
	function reComputeTheme() {
		if (
			localStorage.theme === 'dark' ||
			(!('theme' in localStorage) &&
				window.matchMedia('(prefers-color-scheme: dark)').matches)
		) {
			document.documentElement.classList.add('dark')
		} else {
			document.documentElement.classList.remove('dark')
		}

		const theme = localStorage.theme || 'auto'
		document
			.querySelectorAll(`[data-theme="theme-${theme}"]`)
			.forEach((el) => el.classList.add('active'))
	}

	function addThemeEventListeners() {
		themeButtons = document.querySelectorAll('.theme-button')
		themeButtons.forEach((button) => {
			button.addEventListener('click', () => {
				themeButtons.forEach((btn) => btn.classList.remove('active'))
				button.classList.add('active')
				if (button.dataset.theme === 'theme-auto') {
					localStorage.removeItem('theme')
					reComputeTheme()
				} else {
					localStorage.theme = button.dataset.theme.replace('theme-', '')
					document.documentElement.classList.toggle(
						'dark',
						button.dataset.theme === 'theme-dark'
					)
				}
			})
		})
	}

	// Set active class on OS theme change
	window
		.matchMedia('(prefers-color-scheme: dark)')
		.addEventListener('change', (_e) => {
			reComputeTheme()
		})

	// run recomputeTheme when screen crosses 768px
	window.matchMedia('(min-width: 768px)').addEventListener('change', (_e) => {
		addThemeEventListeners()
		reComputeTheme()
	})

	reComputeTheme()

	// Run on page load
	window.addEventListener('DOMContentLoaded', () => {
		addThemeEventListeners()
		reComputeTheme()
	})
</script>  <main> <article> <div class="app-container flex flex-col lg:flex-row-reverse justify-between gap-8 py-24 relative"> <div class="md:w-1/4 relative"> <div class="sticky top-0 md:top-28 hidden lg:block"> <div></div> </div> </div> <div class="grow w-full md:max-w-[75ch]"> <div> <h1 class="text-4xl sm:text-5xl leading-snug pt-12 font-bold"> GraphQL in Scala: Advanced Schema Generation </h1> <div class="text-lg flex items-center gap-4 flex-wrap py-8"> <!-- Publish date --> <span> <svg width="1em" height="1em" class="inline-block text-primary dark:text-primary-dark" data-icon="mdi:calendar-month-outline">   <symbol id="ai:mdi:calendar-month-outline" viewBox="0 0 24 24"><path fill="currentColor" d="M7 11h2v2H7zm14-6v14c0 1.11-.89 2-2 2H5a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h1V1h2v2h8V1h2v2h1a2 2 0 0 1 2 2M5 7h14V5H5zm14 12V9H5v10zm-4-6v-2h2v2zm-4 0v-2h2v2zm-4 2h2v2H7zm8 2v-2h2v2zm-4 0v-2h2v2z"/></symbol><use href="#ai:mdi:calendar-month-outline"></use>  </svg> <time datetime="2024-01-06T00:00:00.000Z"> 6 Jan 2024 </time> </span> <!-- Updated date -->  <!-- Read time --> <span> <svg width="1em" height="1em" class="inline-block text-primary dark:text-primary-dark" data-icon="mdi:clock-time-four-outline">   <symbol id="ai:mdi:clock-time-four-outline" viewBox="0 0 24 24"><path fill="currentColor" d="M12 20c4.4 0 8-3.6 8-8s-3.6-8-8-8s-8 3.6-8 8s3.6 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10S2 17.5 2 12S6.5 2 12 2m5 11.9l-.7 1.3l-5.3-2.9V7h1.5v4.4z"/></symbol><use href="#ai:mdi:clock-time-four-outline"></use>  </svg> 10 min read </span> </div>  </div> <div class="prose prose-neutral prose-lg md:prose-xl dark:prose-invert prose-img:rounded-xl prose-figure:text-center prose-img:mx-auto">  <p>In my <a href="https://blog.pierre-ricadat.com/a-beginners-guide-to-graphql-in-scala">Beginner’s Guide to GraphQL in Scala</a>, I explained how <a href="https://ghostdogpr.github.io/caliban/">Caliban</a> can automatically transform Scala types into GraphQL types through a process called <em>schema derivation</em>. This mechanism enables you to generate a <code>Schema</code> for user-defined types using a simple import or instruction.</p>
<p>However, there may be instances where Scala types and GraphQL types differ. For example, you might want different names between Scala and GraphQL, and you don’t want to (or can’t) rename the Scala types. There are also situations where your Scala types are not simple case classes, and the automatic derivation doesn’t know how to handle them. In this article, we’ll explore how to address these scenarios.</p>
<p>All code snippets can be reproduced in <a href="https://scala-cli.virtuslab.org/">Scala CLI</a> (using Scala 3, which is the default) by adding the following directive and imports (when more imports are required, they will be added to individual snippets):</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#6A737D">//> </span><span style="color:#F97583">using</span><span style="color:#B392F0"> dep</span><span style="color:#9ECBFF"> com.github.ghostdogpr::caliban-quick:2.5.0</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#B392F0"> caliban</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">*</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#B392F0"> caliban</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">schema</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">*</span></span></code></pre>
<h3 id="annotations-as-an-easy-way-to-customize-schemas">Annotations as an Easy Way to Customize Schemas</h3>
<p>The simplest way to customize the GraphQL types derived from Scala types is to add annotations on the Scala side. These annotations will be read at compile-time (with no runtime impact!) by the derivation logic and will alter the resulting GraphQL types (whether you use automatic or semi-automatic derivation). These annotations are available in the <code>caliban.schema.Annotations</code> package and are all prefixed with <code>@GQL</code>.</p>
<p>Let’s examine a straightforward example.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">case</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Character</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">name</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">derives</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SemiAuto</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">println(render[</span><span style="color:#B392F0">Character</span><span style="color:#E1E4E8">])</span></span>
<span class="line"><span style="color:#6A737D">// type Character {</span></span>
<span class="line"><span style="color:#6A737D">//   name: String!</span></span>
<span class="line"><span style="color:#6A737D">// }</span></span></code></pre>
<p>As expected, the generated GraphQL type matches the Scala type precisely. However, what if we wanted to give this type a different name in GraphQL?</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#B392F0"> caliban</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">schema</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Annotations</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">@</span><span style="color:#B392F0">GQLName</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Person"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">case</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Character</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">name</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">derives</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SemiAuto</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">println(render[</span><span style="color:#B392F0">Character</span><span style="color:#E1E4E8">])</span></span>
<span class="line"><span style="color:#6A737D">// type Person {</span></span>
<span class="line"><span style="color:#6A737D">//   name: String!</span></span>
<span class="line"><span style="color:#6A737D">// }</span></span></code></pre>
<p>Adding the <code>@GQLName</code> annotation before the type modifies the generated GraphQL type by giving it a different name. This annotation can also be used before field names.</p>
<p>Other commonly used annotations include:</p>
<ul>
<li>
<p><code>@GQLDescription</code> adds a description to the annotated type or field</p>
</li>
<li>
<p><code>@GQLExcluded</code> excludes a field from the generated GraphQL type</p>
</li>
<li>
<p><code>@GQLDeprecated</code> adds the <code>@deprecated</code> annotation to the corresponding field in the generated GraphQL type, with a given reason</p>
</li>
</ul>
<p>Another useful annotation is <code>@GQLInputName</code>, but it requires some explanation first. In GraphQL, there is a distinction between <em>object</em> types and <em>input object</em> types. <em>Objects</em> can only be returned as a response, while <em>input objects</em> can only be provided as arguments. This means that if you want the same object to be passed as an input and returned as a response, you need to create two different GraphQL types.</p>
<p>In Scala, however, you can use the same object as both an argument and a return type. Let’s see how Caliban handles this.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">case</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Character</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">name</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">  derives</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SemiAuto</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">ArgBuilder</span></span>
<span class="line"><span style="color:#F97583">case</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> CharacterArgs</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">character</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">Character</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">  derives</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SemiAuto</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">ArgBuilder</span></span>
<span class="line"><span style="color:#F97583">case</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Query</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">addCharacter</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">CharacterArgs</span><span style="color:#F97583"> =></span><span style="color:#B392F0"> Character</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">  derives</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SemiAuto</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">println(render[</span><span style="color:#B392F0">Query</span><span style="color:#E1E4E8">])</span></span>
<span class="line"><span style="color:#6A737D">// input CharacterInput {</span></span>
<span class="line"><span style="color:#6A737D">//   name: String!</span></span>
<span class="line"><span style="color:#6A737D">// }</span></span>
<span class="line"><span style="color:#6A737D">//</span></span>
<span class="line"><span style="color:#6A737D">// type Character {</span></span>
<span class="line"><span style="color:#6A737D">//   name: String!</span></span>
<span class="line"><span style="color:#6A737D">// }</span></span>
<span class="line"><span style="color:#6A737D">//</span></span>
<span class="line"><span style="color:#6A737D">// type Query {</span></span>
<span class="line"><span style="color:#6A737D">//   addCharacter(character: CharacterInput!): Character!</span></span>
<span class="line"><span style="color:#6A737D">// }</span></span></code></pre>
<p>As you can see, Caliban generates two GraphQL types: the regular object type is named after the Scala type (<code>Character</code>), while the input type has the <code>Input</code> suffix added (<code>CharacterInput</code>). This is Caliban’s default behavior for naming input object types. However, by using the <code>@GQLInputName</code> annotation, you can rename the GraphQL type only when it is used as an input.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#B392F0"> caliban</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">schema</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Annotations</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">@</span><span style="color:#B392F0">GQLName</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Person"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">@</span><span style="color:#B392F0">GQLInputName</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"IPerson"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">case</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Character</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">name</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">  derives</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SemiAuto</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">ArgBuilder</span></span>
<span class="line"><span style="color:#F97583">case</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> CharacterArgs</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">character</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">Character</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">  derives</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SemiAuto</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">ArgBuilder</span></span>
<span class="line"><span style="color:#F97583">case</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Query</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">addCharacter</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">CharacterArgs</span><span style="color:#F97583"> =></span><span style="color:#B392F0"> Character</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">  derives</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SemiAuto</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">println(render[</span><span style="color:#B392F0">Query</span><span style="color:#E1E4E8">])</span></span>
<span class="line"><span style="color:#6A737D">// input IPerson {</span></span>
<span class="line"><span style="color:#6A737D">//   name: String!</span></span>
<span class="line"><span style="color:#6A737D">// }</span></span>
<span class="line"><span style="color:#6A737D">//</span></span>
<span class="line"><span style="color:#6A737D">// type Person {</span></span>
<span class="line"><span style="color:#6A737D">//   name: String!</span></span>
<span class="line"><span style="color:#6A737D">// }</span></span>
<span class="line"><span style="color:#6A737D">//</span></span>
<span class="line"><span style="color:#6A737D">// type Query {</span></span>
<span class="line"><span style="color:#6A737D">//   addCharacter(character: IPerson!): Person!</span></span>
<span class="line"><span style="color:#6A737D">// }</span></span></code></pre>
<p>See the <a href="https://ghostdogpr.github.io/caliban/docs/schema.html#annotations">Caliban documentation</a> for a complete list of available annotations.</p>
<p>Using annotations is nice and easy, but there may be situations where we cannot use them. For instance, we might not own the type we want to annotate because it comes from a dependency, or we may not want to “pollute” our code with GraphQL-related elements. One option is to create dedicated types solely for defining your GraphQL API, but this approach requires additional boilerplate and transformations between your original types and your API types. A more efficient solution is to create custom schemas by reusing existing or automatically-generated ones.</p>
<h3 id="creating-schemas-from-existing-schemas">Creating Schemas from Existing Schemas</h3>
<p>Before delving deeper, you’ll need a basic understanding of type classes in Scala. I recommend checking out this <a href="https://www.47deg.com/blog/scala-3-typeclasses/">excellent introduction to type classes in Scala 3</a> as well as the <a href="https://docs.scala-lang.org/scala3/book/ca-type-classes.html">dedicated section in the Scala documentation</a>. Why is this relevant? Because Caliban’s <code>Schema</code> is a type class: when you call the <code>render</code> function as we did earlier, it requires a <code>given Schema</code> (an <em>instance</em> of the <code>Schema</code> <em>type class</em>) in scope for the type passed as a parameter, and for all the nested types referenced within that type. In other words, when I call <code>render[Character]</code>, it will only compile if there is a <code>Schema</code> for <code>Character</code> in scope.</p>
<p>Fortunately, most of the time we don’t need to worry about this because Caliban already comes with type class instances for the most commonly used Scala types. Adding <code>derives Schema.SemiAuto</code> or <code>import caliban.schema.Schema.auto.*</code> in your code creates the required <code>given</code> for you transparently. However, creating a customized <code>Schema</code> will require that you provide your own <code>given</code>.</p>
<p>Suppose you want to use a Scala type named <code>Id</code> that is actually an <code>Int</code>. Scala has a useful feature called <a href="https://docs.scala-lang.org/scala3/book/types-opaque-types.html">opaque types</a> that allows you to create an alias for a type that will be <em>opaque</em> to the rest of the code (the rest of the code won’t know the underlying type; it is only known in the scope where the opaque type is defined).</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">object</span><span style="color:#B392F0"> Types</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  opaque</span><span style="color:#F97583"> type</span><span style="color:#B392F0"> Id</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> Int</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>This defines an opaque type <code>Id</code> that conceals the underlying <code>Int</code>. It’s important to note that there is no runtime overhead (at runtime, the type will simply be <code>Int</code>).</p>
<p>However, when attempting to use our opaque type with Caliban, we encounter an issue.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#B392F0"> Types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">*</span></span>
<span class="line"><span style="color:#F97583">case</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Character</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">Id</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">derives</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SemiAuto</span></span>
<span class="line"><span style="color:#6A737D">//   1 |case class Character(id: Id) derives Schema.SemiAuto</span></span>
<span class="line"><span style="color:#6A737D">//     |                                            ^</span></span>
<span class="line"><span style="color:#6A737D">//     |Cannot find a Schema for type Types.Id.</span></span></code></pre>
<p>The compiler complains that it cannot find a <code>Schema</code> for <code>Id</code>. This makes sense: Caliban has no idea what <code>Id</code> is (because it’s opaque), so it cannot generate a <code>Schema</code> for it automatically or reuse an already defined one.</p>
<p>To solve this problem, we need to create a <code>Schema</code> for <code>Id</code> ourselves and use the <code>given</code> keyword to ensure it’s in scope wherever we need a <code>Schema</code>. However, we don’t have to write it from scratch: we can reuse the schema for <code>Int</code> provided by Caliban (defined by <code>Schema.intSchema</code>). For now, you can ignore <code>Any</code> in the following examples; I will address it in a future article.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">object</span><span style="color:#B392F0"> Types</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  opaque</span><span style="color:#F97583"> type</span><span style="color:#B392F0"> Id</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> Int</span></span>
<span class="line"><span style="color:#F97583">  given</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">[</span><span style="color:#B392F0">Any</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">Id</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">.intSchema</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#B392F0"> Types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">*</span></span>
<span class="line"><span style="color:#F97583">case</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Character</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">Id</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">derives</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SemiAuto</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">println(render[</span><span style="color:#B392F0">Character</span><span style="color:#E1E4E8">])</span></span>
<span class="line"><span style="color:#6A737D">// type Character {</span></span>
<span class="line"><span style="color:#6A737D">//   id: Int!</span></span>
<span class="line"><span style="color:#6A737D">// }</span></span></code></pre>
<p>Within our <code>Types</code> object, <code>Id</code> and <code>Int</code> are equivalent, so <code>Schema[Any, Id]</code> is the same as <code>Schema[Any, Int]</code>. This means we can simply assign <code>Schema.intSchema</code> as a value for our <code>Schema[Any, Id]</code>. This <code>given</code> is found when we attempt to create a schema for <code>Character</code>, preventing any compile errors, and we see that the corresponding GraphQL type is an <code>Int</code> as intended.</p>
<p>What if we wanted our <code>Id</code> to be a <code>String</code> in the GraphQL schema, but keep it as an <code>Int</code> in Scala? That’s easy to achieve: instead of reusing Caliban’s <code>Schema</code> for <code>Int</code>, we can reuse its <code>Schema</code> for <code>String</code>. The only additional step we need to take is to tell Caliban how to transform an <code>Id</code> into a <code>String</code> so that our resolver returns something that matches our schema. This can be done using the <code>contramap</code> function, as demonstrated below.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">object</span><span style="color:#B392F0"> Types</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  opaque</span><span style="color:#F97583"> type</span><span style="color:#B392F0"> Id</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> Int</span></span>
<span class="line"><span style="color:#F97583">  given</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">[</span><span style="color:#B392F0">Any</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">Id</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">.stringSchema.contramap(_.toString)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#B392F0"> Types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">*</span></span>
<span class="line"><span style="color:#F97583">case</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Character</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">Id</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">derives</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SemiAuto</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">println(render[</span><span style="color:#B392F0">Character</span><span style="color:#E1E4E8">])</span></span>
<span class="line"><span style="color:#6A737D">// type Character {</span></span>
<span class="line"><span style="color:#6A737D">//   id: String!</span></span>
<span class="line"><span style="color:#6A737D">// }</span></span></code></pre>
<p>In summary, <code>contramap</code> enables the creation of a <code>Schema</code> for <code>A</code> given an existing <code>Schema</code> for <code>B</code> and a function from <code>B</code> to <code>A</code>. This makes it easy to support many “unknown” types as long as they closely resemble any type that already has a <code>Schema</code>.</p>
<p>For an additional example, here’s how to define a <code>Schema</code> for <code>Vector</code> that simply reuses the <code>Schema</code> for <code>List</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">given</span><span style="color:#B392F0"> vectorSchema</span><span style="color:#E1E4E8">[</span><span style="color:#B392F0">A</span><span style="color:#E1E4E8">](</span><span style="color:#F97583">using</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">[</span><span style="color:#B392F0">Any</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">A</span><span style="color:#E1E4E8">])</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">[</span><span style="color:#B392F0">Any</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">Vector</span><span style="color:#E1E4E8">[</span><span style="color:#B392F0">A</span><span style="color:#E1E4E8">]] </span><span style="color:#F97583">=</span></span>
<span class="line"><span style="color:#B392F0">  Schema</span><span style="color:#E1E4E8">.listSchema.contramap(_.toList)</span></span></code></pre>
<p>Another simple action you can perform with an existing <code>Schema</code> is renaming the type using the <code>rename</code> function. You can use <code>Schema.gen</code> to obtain the auto-generated <code>Schema</code> when it’s not directly provided by Caliban as with <code>Int</code> and <code>String</code> above, and then apply <code>rename</code> or <code>contramap</code> to it.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">case</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Character</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">name</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">given</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">[</span><span style="color:#B392F0">Any</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">Character</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span></span>
<span class="line"><span style="color:#B392F0">  Schema</span><span style="color:#E1E4E8">.gen[</span><span style="color:#B392F0">Any</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">Character</span><span style="color:#E1E4E8">].rename(</span><span style="color:#9ECBFF">"Person"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">println(render[</span><span style="color:#B392F0">Character</span><span style="color:#E1E4E8">])</span></span>
<span class="line"><span style="color:#6A737D">// type Person {</span></span>
<span class="line"><span style="color:#6A737D">//   name: String!</span></span>
<span class="line"><span style="color:#6A737D">// }</span></span></code></pre>
<p>However, there are still cases where this is not sufficient: what if there is no existing <code>Schema</code> that we can reuse, or if we cannot use schema derivation at all (a common issue is that derivation sometimes struggles with recursive types)? You can always fall back to creating your instance of <code>Schema</code> from scratch.</p>
<h3 id="manually-creating-schemas">Manually Creating Schemas</h3>
<p>Under the hood, the <code>Schema</code> type class is defined as follows:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">trait</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">[</span><span style="color:#F97583">-</span><span style="color:#B392F0">R</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">] {</span></span>
<span class="line"><span style="color:#F97583">  def</span><span style="color:#B392F0"> toType</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">isInput</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">Boolean</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">isSubscription</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">Boolean</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> __Type</span></span>
<span class="line"><span style="color:#F97583">  def</span><span style="color:#B392F0"> resolve</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">value</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">:</span><span style="color:#B392F0"> Step</span><span style="color:#E1E4E8">[</span><span style="color:#B392F0">R</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>A <code>Schema</code> of <code>T</code> with an incoming context <code>R</code> requires two things:</p>
<ul>
<li>
<p>A function <code>toType</code> that defines the shape of the GraphQL type generated from <code>T</code>. It returns a <code>__Type</code>, which represents a GraphQL type as defined in the <a href="https://spec.graphql.org/October2021/#sec-The-__Type-Type">GraphQL spec</a>.</p>
</li>
<li>
<p>A function <code>resolve</code> that describes how to compute a resolver value of type <code>T</code>. It returns a <code>Step</code>, which represents a tree of operations that will eventually produce a <code>ResponseValue</code> (the content of the <code>data</code> field in the GraphQL response).</p>
</li>
</ul>
<p>In this article, <code>R</code> is always <code>Any</code>, meaning we’re not making use of the context. I will cover this in a future article.</p>
<p>While you can create a new <code>Schema</code> by implementing these two methods yourself, doing so requires a deeper understanding of the GraphQL spec and how <code>Step</code> works. If you only want to define types manually, there are helper functions to make this process easier.</p>
<p>The most useful one is <code>Schema.obj</code> for creating a <code>Schema</code> for an object type. It takes a name as a parameter (along with an optional description and list of directives) and a list of fields, which you can create by calling <code>Schema.field</code>. The <code>field</code> helper requires the name of the field and a function defining how to resolve the field from its parent object.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">case</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Character</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">name</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">age</span><span style="color:#E1E4E8">: </span><span style="color:#B392F0">Int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">given</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">[</span><span style="color:#B392F0">Any</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">Character</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span></span>
<span class="line"><span style="color:#B392F0">  Schema</span><span style="color:#E1E4E8">.obj(</span><span style="color:#9ECBFF">"Character"</span><span style="color:#E1E4E8">) { </span><span style="color:#F97583">case</span><span style="color:#F97583"> given</span><span style="color:#B392F0"> FieldAttributes</span><span style="color:#F97583"> =></span></span>
<span class="line"><span style="color:#B392F0">    List</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#B392F0">      Schema</span><span style="color:#E1E4E8">.field(</span><span style="color:#9ECBFF">"name"</span><span style="color:#E1E4E8">)(_.name),</span></span>
<span class="line"><span style="color:#B392F0">      Schema</span><span style="color:#E1E4E8">.field(</span><span style="color:#9ECBFF">"age"</span><span style="color:#E1E4E8">)(_.age)</span></span>
<span class="line"><span style="color:#E1E4E8">    )</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">println(render[</span><span style="color:#B392F0">Character</span><span style="color:#E1E4E8">])</span></span>
<span class="line"><span style="color:#6A737D">// type Character {</span></span>
<span class="line"><span style="color:#6A737D">//   name: String!</span></span>
<span class="line"><span style="color:#6A737D">//   age: Int!</span></span>
<span class="line"><span style="color:#6A737D">// }</span></span></code></pre>
<p>The code above generates the same <code>Schema</code> that would be produced if you simply called <code>given Schema[Any, Character] = Schema.gen</code> or used other derivation methods.</p>
<p>This boilerplate-y method of creating a <code>Schema</code> is quite similar to what many GraphQL libraries require and what Caliban aims to avoid, thanks to its use of derivation. However, it is available for cases where other methods cannot be used.</p>
<p>Note that you can define a single type manually like this while keeping everything else defined automatically; you don’t have to use the same generation method everywhere.</p>
<p>Another useful helper function is <code>scalarSchema</code> for creating custom scalars:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="scala"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#B392F0"> java</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">util</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">UUID</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#B392F0"> caliban</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Value</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">given</span><span style="color:#B392F0"> Schema</span><span style="color:#E1E4E8">[</span><span style="color:#B392F0">Any</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">UUID</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span></span>
<span class="line"><span style="color:#B392F0">  Schema</span><span style="color:#E1E4E8">.scalarSchema(</span></span>
<span class="line"><span style="color:#E1E4E8">    name </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "ID"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    description </span><span style="color:#F97583">=</span><span style="color:#B392F0"> None</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    specifiedBy </span><span style="color:#F97583">=</span><span style="color:#B392F0"> None</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    directives </span><span style="color:#F97583">=</span><span style="color:#B392F0"> None</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    makeResponse </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> uuid </span><span style="color:#F97583">=></span><span style="color:#B392F0"> StringValue</span><span style="color:#E1E4E8">(uuid.toString)</span></span>
<span class="line"><span style="color:#E1E4E8">  )</span></span></code></pre>
<p>This example demonstrates how to use the <code>ID</code> scalar in GraphQL when using Java’s <code>UUID</code> on the Scala side.</p>
<h3 id="going-further">Going Further</h3>
<p>Here are a few resources to explore for more advanced use cases of Schema derivation:</p>
<ul>
<li>
<p>Caliban’s <a href="https://ghostdogpr.github.io/caliban/docs/schema.html">documentation on schemas</a></p>
</li>
<li>
<p>Caliban’s <a href="https://github.com/ghostdogpr/caliban/blob/bd58e5efd77b929d47cab2050914e25c67dc33ad/core/src/main/scala/caliban/schema/Schema.scala#L325">code defining <code>Schema</code> for the most commonly used Scala types</a></p>
</li>
</ul>
<p>In conclusion, Caliban offers a powerful and flexible approach to generating GraphQL schemas. Through automatic schema derivation, compile-time annotations, schema transformations, and full manual schema definition, you can create GraphQL APIs that meet your specific needs.</p>
<p>Next time, we’ll take a deep dive into laziness, asynchronous computations, and effects!</p>  </div> </div> </div> </article> </main>  <footer> <div class="app-container grid md:grid-cols-3 gap-12 py-16 border-t-2 border-foreground/50 dark:border-foreground-dark/50"> <div> <a href="/" class="block w-fit" aria-label="Home"> <svg width="36" height="36" viewBox="0 0 36 36" fill="none">
  <rect width="36" height="36" rx="8" fill="currentColor" opacity="0.1" />
  <text x="18" y="25" font-family="system-ui, -apple-system, sans-serif" font-size="18" font-weight="700" fill="currentColor" text-anchor="middle">PR</text>
</svg> </a> </div> <div> <h3 class="font-semibold text-2xl">Links</h3> <div class="flex flex-wrap gap-4 mt-4"> <a class="text-lg" href target="_blank" rel="noopener noreferrer"> Blog </a><a class="text-lg" href="https://github.com/sponsors/ghostdogpr" target="_blank" rel="noopener noreferrer"> Sponsor </a> <a href="rss.xml" target="_blank" rel="noopener noreferrer" class="text-lg" aria-label="RSS Feed"> <svg width="1em" height="1em" class="w-6 h-6" data-icon="mdi:rss">   <symbol id="ai:mdi:rss" viewBox="0 0 24 24"><path fill="currentColor" d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27zm0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93z"/></symbol><use href="#ai:mdi:rss"></use>  </svg> </a> </div> </div> <div> <h3 class="font-semibold text-2xl">Socials</h3> <div class="flex flex-wrap gap-4 mt-4"> <a class="text-lg" href="https://github.com/ghostdogpr" target="_blank" rel="noopener noreferrer"> GitHub </a><a class="text-lg" href="https://www.linkedin.com/in/pierrericadat/" target="_blank" rel="noopener noreferrer"> LinkedIn </a><a class="text-lg" href="https://twitter.com/ghostdogpr" target="_blank" rel="noopener noreferrer"> X / Twitter </a> </div> </div> </div> <div class="app-container flex justify-between items-center pb-6 text-center"> <p class="text-left md:text-center w-full">
Theme: <a class="underline" href="https://github.com/yashjawale/saral-theme-astro" target="_blank">Saral</a> </p> </div> </footer> </body></html>